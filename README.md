# Claude Book

A CLI tool for organizing family photos using face recognition. Automatically identifies family members in your photo library and organizes them into Apple Photos albums.

## What It Does

- **Scans** your photo library (local folders, iCloud Photos, Telegram exports)
- **Recognizes** faces using AWS Rekognition
- **Organizes** photos into Apple Photos albums by person

## Quick Start

```bash
# Install dependencies
bun install

# Install osxphotos (required for Apple Photos integration)
uv tool install osxphotos
# or: pip install osxphotos

# 1. Initialize (creates config, sets up AWS collection)
claude-book init

# 2. Train with reference photos
#    Create folders: ./references/mom/, ./references/dad/, ./references/kid1/
#    Add 3-5 clear face photos to each folder
claude-book train -r ./references

# 3. Scan your photo library and create albums
claude-book scan -p ~/Pictures/Family

# Photos are now organized into albums:
#   "Claude Book: Mom", "Claude Book: Dad", etc.
```

## Commands

| Command | Description |
|---------|-------------|
| `claude-book init` | Initialize config and AWS Rekognition collection |
| `claude-book train -r <path>` | Index faces from reference folders |
| `claude-book scan -p <path>` | Scan photos and create Apple Photos albums |
| `claude-book scan --dry-run` | Preview what albums would be created |
| `claude-book status` | Show collection info and stats |
| `claude-book cleanup` | Remove AWS collection |

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                         CLI Layer                            │
│  Commands: init | train | scan | status | cleanup           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Core Pipeline                           │
│  1. Scan photos → 2. Detect faces → 3. Match people         │
│  4. Group by person → 5. Create Apple Photos albums         │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│ Photo Sources │    │  Recognition  │    │ Album Export  │
├───────────────┤    ├───────────────┤    ├───────────────┤
│ Local folders │    │ AWS           │    │ osxphotos     │
│ iCloud Photos │    │ Rekognition   │    │ Apple Photos  │
└───────────────┘    └───────────────┘    └───────────────┘
```

### Data Flow

1. **Training Phase**
   ```
   Reference Photos → Detect Faces → Index to AWS Collection
   ./references/mom/*.jpg → face vectors → "claude-book-faces" collection
   ```

2. **Scanning Phase**
   ```
   Photo Library → Detect Faces → Match Against Collection → Create Albums
   ~/Pictures/*.jpg → faces found → "mom: 94%" → "Claude Book: Mom" album
   ```

### Multi-Person Photos

Photos with multiple recognized people are added to **all** matching albums:
- Photo with Mom + Dad → added to both "Claude Book: Mom" AND "Claude Book: Dad"

## Tech Stack

| Technology | Purpose |
|------------|---------|
| **Bun** | Runtime - fast TypeScript execution |
| **TypeScript** | Type-safe development |
| **AWS Rekognition** | Face detection and recognition (~$1/1000 photos) |
| **osxphotos** | Apple Photos album creation |

### Dependencies

```
@aws-sdk/client-rekognition  - AWS face recognition API
sharp                        - Image processing and resizing
commander                    - CLI framework
zod                          - Config validation
bottleneck                   - API rate limiting
ora, cli-progress            - CLI progress indicators
```

## Configuration

Create `config.yaml` in the project root (auto-generated by `init`):

```yaml
aws:
  region: us-east-1

rekognition:
  collectionId: claude-book-faces
  minConfidence: 80              # Minimum match confidence (0-100)

sources:
  local:
    paths:
      - ~/Pictures/Family
    extensions:
      - ".jpg"
      - ".jpeg"
      - ".png"
      - ".heic"

training:
  referencesPath: ./references

albums:
  prefix: "Claude Book"          # Albums: "Claude Book: Mom", "Claude Book: Dad"
```

### Environment Variables

```bash
# AWS credentials (or use ~/.aws/credentials)
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
AWS_REGION=us-east-1
```

## Reference Photos Structure

Organize reference photos with one folder per person:

```
references/
├── mom/
│   ├── photo1.jpg      # Clear face, good lighting
│   ├── photo2.jpg      # Different angle
│   └── photo3.jpg      # 3-5 photos recommended
├── dad/
│   ├── photo1.jpg
│   └── photo2.jpg
└── kid1/
    ├── photo1.jpg
    └── photo2.jpg
```

**Tips for reference photos:**
- Use clear, well-lit photos with one face per image
- Include different angles and expressions
- 3-5 photos per person is usually sufficient
- Avoid group photos for training

## iCloud Photos Integration

iCloud Photos syncs to a local folder on macOS. Point claude-book at the Photos Library:

```bash
# Scan iCloud Photos library
claude-book scan -p ~/Pictures/Photos\ Library.photoslibrary/originals
```

Or export photos first for better results:
1. Select photos in Apple Photos
2. File → Export → Export Unmodified Originals
3. `claude-book scan -p ~/exported-photos`

## Telegram Integration

Family photos are often shared in Telegram groups:

### Step 1: Export from Telegram Desktop

1. Open **Telegram Desktop** (not mobile app)
2. Go to the group chat with family photos
3. Click **⋮** → **Export chat history**
4. Check **Photos**, choose export location
5. Click **Export**

### Step 2: Scan the Export

```bash
claude-book scan -p ~/Downloads/TelegramExport/photos
```

## Prerequisites

1. **AWS Account** with Rekognition access
2. **osxphotos** installed:
   ```bash
   uv tool install osxphotos
   # or: pip install osxphotos
   ```
3. **Bun** runtime: https://bun.sh

## License

MIT
